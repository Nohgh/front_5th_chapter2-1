(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))s(c);new MutationObserver(c=>{for(const o of c)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function n(c){const o={};return c.integrity&&(o.integrity=c.integrity),c.referrerPolicy&&(o.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?o.credentials="include":c.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(c){if(c.ep)return;c.ep=!0;const o=n(c);fetch(c.href,o)}})();class l{constructor({tag:e,id:n,className:s,textContent:c}){this.$element=document.createElement(e),n&&(this.$element.id=n),s&&(this.$element.className=s),c&&(this.$element.textContent=c)}get(){return this.$element}}class N extends l{constructor(){super({tag:"select",id:"product-select",className:"border rounded p-2 mr-2"})}}const m=new N().get(),a=[{id:"p1",name:"상품1",price:1e4,stock:50},{id:"p2",name:"상품2",price:2e4,stock:30},{id:"p3",name:"상품3",price:3e4,stock:20},{id:"p4",name:"상품4",price:15e3,stock:0},{id:"p5",name:"상품5",price:25e3,stock:10}],I=()=>{m.innerHTML="",a.forEach(t=>{let e=document.createElement("option");e.value=t.id,e.textContent=`${t.name} - ${t.price}원`,t.stock===0&&(e.disabled=!0),m.appendChild(e)})};class k extends l{constructor(){super({tag:"h1",className:"text-2xl font-bold mb-4",textContent:"장바구니"})}}const v=new k().get();class w extends l{constructor(){super({tag:"div",id:"cart-items"})}}const h=new w().get();class L extends l{constructor(){super({tag:"div",id:"cart-total",className:"text-xl font-bold my-4"})}}const f=new L().get();class O extends l{constructor(){super({tag:"button",id:"add-to-cart",className:"bg-blue-500 text-white px-4 py-2 rounded",textContent:"추가"})}}const T=new O().get();class D extends l{constructor(){super({tag:"div",id:"stock-status",className:"text-sm text-gray-500 mt-2"})}}const E=new D().get(),U=()=>{const t=document.createElement("div");t.className="max-w-md mx-auto bg-white rounded-xl shadow-md overflow-hidden md:max-w-2xl p-8",t.appendChild(v),t.appendChild(h),t.appendChild(f),t.appendChild(m),t.appendChild(T),t.appendChild(E);const e=document.createElement("div");e.className="bg-gray-100 p-8",e.appendChild(t),document.getElementById("app").appendChild(e)};class ${constructor(){this.recentSelectedId=0}get(){return this.recentSelectedId}set(e){this.recentSelectedId=e}}class M{constructor(){this.totalPrice=0}get(){return this.totalPrice}set(e){this.totalPrice=e}}const _={p1:.1,p2:.15,p3:.2,p4:.05,p5:.25},A=30,C=.25,y=.1,R=t=>{let e=h.children,n=0,s=0;for(let c=0;c<e.length;c++){const o=e[c],r=a.find(p=>p.id===o.id);if(!r)continue;const u=parseInt(o.querySelector("span").textContent.split("x ")[1]),d=r.price*u;n+=u,s+=d;let i=0;u>=10&&(i=_[r.id]||0),t.set(t.get()+d*(1-i))}return{itemCount:n,subTotalPrice:s}},B=t=>t>=A,q=(t,e,n)=>{let s=t.get()*C,c=e-t.get();return s>c&&(t.set(e*(1-C)),n=C),n},P=(t,e)=>(t-e.get())/t,G=()=>new Date().getDay()===2,Q=(t,e)=>(t.set(t.get()*(1-y)),e=Math.max(e,y),e),K=t=>{const{itemCount:e,subTotalPrice:n}=R(t);let s=0;return s=B(e)?q(t,n,s):P(n,t),G()&&(s=Q(t,s)),s},Y=t=>{f.textContent="총액: "+Math.round(t.get())+"원"},F=t=>{let e=document.createElement("span");e.className="text-green-500 ml-2",e.textContent="("+(t*100).toFixed(1)+"% 할인 적용)",f.appendChild(e)},H=(t,e)=>{Y(t),e>0&&F(e)},V=5,j=()=>{let t="";a.forEach(e=>{e.stock<V&&(t+=`${e.name}: ${e.stock>0?"재고 부족 ("+e.stock+"개 남음)":"품절"}
`)}),E.textContent=t},z=t=>Math.floor(t.get()/1e3),J=()=>{const t=document.createElement("span");return t.id="loyalty-points",t.className="text-blue-500 ml-2",f.appendChild(t),t},W=(t,e)=>(t.textContent="(포인트: "+e+")",t),X=t=>{const e=z(t);let n=document.getElementById("loyalty-points");n||(n=J()),W(n,e)},x=()=>{let t=new M;const e=K(t);H(t,e),j(),X(t)},Z=(t,e)=>t.id===e,tt=t=>a.find(e=>Z(e,t)),et=t=>t&&t.stock>0,nt=(t,e)=>{const n=t.querySelector("span").textContent;let s=parseInt(n.split("x ")[1])+1;s<=e.stock?(t.querySelector("span").textContent=`${e.name} - ${e.price}원 x ${s}`,e.stock--):alert("재고가 부족합니다.")},ct=(t,e)=>{const n=document.createElement("div");n.id=t.id,n.className="flex justify-between items-center mb-2",n.innerHTML=`
		<span>${t.name} - ${t.price}원 x 1</span>
		<div>
		  <button class="quantity-change bg-blue-500 text-white px-2 py-1 rounded mr-1" 
				  data-product-id="${t.id}" 
				  data-change="-1">-</button>
		  <button class="quantity-change bg-blue-500 text-white px-2 py-1 rounded mr-1" 
				  data-product-id="${t.id}" 
				  data-change="1">+</button>
		  <button class="remove-item bg-red-500 text-white px-2 py-1 rounded" 
				  data-product-id="${t.id}">삭제</button>
		</div>
	  `,e.appendChild(n),t.stock--},st=t=>{new $().set(t)},ot=()=>{T.addEventListener("click",()=>{let t=m.value,e=tt(t);if(!et(e))return;let n=document.getElementById(e.id);n?nt(n,e):ct(e,h),x(),st(t)})},rt=t=>t.classList.contains("quantity-change")||t.classList.contains("remove-item"),at=t=>a.find(e=>e.id===t),it=t=>t.classList.contains("quantity-change"),dt=t=>t.classList.contains("remove-item"),lt=(t,e,n)=>{const s=parseInt(t.dataset.change),c=e.querySelector("span"),o=c.textContent,[r,u]=o.split("x "),d=parseInt(u),i=d+s,p=n.stock+d;i<=0&&(e.remove(),n.stock+=d),i<=p&&(c.textContent=`${r}x ${i}`,n.stock=p-i),alert("재고가 부족합니다.")},ut=(t,e)=>{let n=parseInt(t.querySelector("span").textContent.split("x ")[1]);e.stock+=n,t.remove()},pt=()=>{h.addEventListener("click",t=>{let e=t.target;if(!rt(e))return;let n=e.dataset.productId,s=document.getElementById(n),c=at(n);it(e)&&lt(e,s,c),dt(e)&&ut(s,c),x()})},mt=()=>{ot(),pt()},gt=Math.random()*1e4,ht=Math.random()*2e4,ft=3e4,Ct=6e4,It=.8,xt=.95,yt=.3;let g=a[Math.floor(Math.random()*a.length)];const St=()=>Math.random()<yt&&g.stock>0,Tt=()=>Math.round(g.price*It),Et=()=>{St()&&(g.price=Tt(),alert("번개세일! "+g.name+"이(가) 20% 할인 중입니다!"),I())};let b=new $().get();const $t=()=>a.find(t=>t.id!==b&&t.stock>0),bt=t=>Math.round(t.price*xt),Nt=()=>{if(!b)return;let t=$t();t&&(alert(t.name+"은(는) 어떠세요? 지금 구매하시면 5% 추가 할인!"),t.price=bt(t),I())},S=[gt,ht],kt=[ft,Ct],vt=[Et,Nt],wt=()=>{for(let t=0;t<S.length;t++)setTimeout(()=>{setInterval(()=>{vt[t]()},kt[t])},S[t])},Lt=()=>{I(),x(),wt(),mt(),U()};Lt();
